# Матрица соответствия ТЗ

## Админ-панель

| Раздел ТЗ | Статус | Реализация |
| --- | --- | --- |
| 2.2.1 Авторизация | Закрыто | `POST /api/auth/login`, `POST /api/auth/logout`, `GET /api/auth/me`, JWT + CSRF + rate-limit |
| 2.2.2 Дашборд | Закрыто | Модульный экран с KPI, быстрыми действиями, блоком активности и графиком роста |
| 2.2.3 Пользователи | Закрыто | refine CRUD (`list/create/edit/delete`) + backend RBAC + CSV экспорт |
| 2.2.4 Акции | Закрыто | refine CRUD для `promotions` + backend ограничения публикации по ролям |
| 2.2.5 Новинки | Закрыто | refine CRUD для `news` + backend ограничения публикации по ролям |
| 2.2.6 Приходы | Закрыто | refine CRUD для `deliveries` + backend ограничения публикации по ролям |
| 2.2.7 Рассылки | Закрыто | wizard 4 шага + test-send + schedule + send/cancel/retry + расширенная статистика |
| 2.2.8 Аналитика и отчеты | Закрыто | вкладки users/mailings/content/conversions + cohort + CSV export |
| 2.2.9 Настройки системы | Закрыто | key-value settings, backup/list/download, backup policy (schedule/retention), restore dry-run/apply |
| 2.2.10 Администраторы и роли | Закрыто | refine route guards + backend RBAC, экран `Admins`, аудит ролевых отказов |

## Безопасность

| Раздел ТЗ | Статус | Реализация |
| --- | --- | --- |
| 8.1 Защита админ-панели | Закрыто | JWT, CSRF, role-based access на API и UI, login rate-limit, аудит неуспешного входа и rbac_denied |
| 8.3 Валидация | Закрыто | Валидация payload, upload size/MIME/extension/signature |
| 8.4 Логирование | Частично закрыто | ActivityLog + export; хранение 90 дней задается политикой эксплуатации |

## Бот

| Раздел ТЗ | Статус | Реализация |
| --- | --- | --- |
| 2.1.1 Регистрация | Закрыто | `/start`, выбор сегмента, ввод заведения, запись в БД |
| 2.1.2 Главное меню | Закрыто | inline кнопки: акции/новинки/приходы/менеджер |
| 2.1.3-2.1.5 Контент | Закрыто | выдача по сегменту с фильтрацией по user_type |
| 2.1.6 Связь с менеджером | Закрыто | URL-кнопка на `https://t.me/{manager_username}` |

## Расширенная спецификация «бот» (документ «бот»)

Реализовано по документу «бот».

| Пункт расширенной спецификации | Статус | Реализация |
| --- | --- | --- |
| Запрос телефона (RequestContact) при регистрации | Закрыто | Кнопка «Отправить номер телефона», обработка `F.contact` в FSM |
| Поля пользователя: phone_number, full_name, birth_date, position | Закрыто | Модель `User`, миграция `0004_bot_extended` |
| Валидация возраста 18+ по дате рождения | Закрыто | Формат ДД.ММ.ГГГГ, сообщение при возрасте &lt; 18, кнопка «Ввести дату заново» |
| Раздел «Мероприятия» в боте | Закрыто | Модель `Event`, хендлер `menu_events`, фильтр по user_type и event_date |
| Раздел «Мой профиль» (просмотр/редактирование) | Закрыто | Хендлер `menu_profile`, редактирование заведения/имени/даты рождения/должности/телефона |
| API мероприятий в админке | Закрыто | `GET/POST/PUT/DELETE /api/events`, схемы EventCreate/EventUpdate/EventOut |
| Фильтры в админке: по возрасту, должности, именинники | Не реализовано | Поиск пользователей по full_name и phone_number добавлен |

## Открытые пункты до полного соответствия

- PDF-экспорт аналитики вынесен во вторую итерацию.
- Нагрузочный контур/SLA-тесты требуют отдельной инфраструктурной задачи.
